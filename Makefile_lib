# Makefile for LibVisualMem - Visual Memory Library
# ================================================

CC = gcc
CFLAGS = -Wall -Wextra -std=c99 -g -O2
AR = ar
ARFLAGS = rcs

# Library configuration
LIBRARY_NAME = libvisualmem
STATIC_LIB = $(LIBRARY_NAME).a
SHARED_LIB = $(LIBRARY_NAME).so
VERSION = 1.0.0

# Source files
LIB_SOURCES = libvisualmem.c
LIB_OBJECTS = $(LIB_SOURCES:.c=.o)
LIB_HEADERS = libvisualmem.h

# Test and example programs
TEST_SOURCES = test_libvisualmem.c
EXAMPLE_SOURCES = example_usage.c
TEST_TARGET = test_libvisualmem
EXAMPLE_TARGET = example_usage

# Default target
all: $(STATIC_LIB) $(SHARED_LIB) $(TEST_TARGET) $(EXAMPLE_TARGET)

# Library compilation
$(STATIC_LIB): $(LIB_OBJECTS)
	@echo "Creating static library $(STATIC_LIB)..."
	$(AR) $(ARFLAGS) $@ $^
	@echo "âœ… Static library created: $(STATIC_LIB)"

$(SHARED_LIB): $(LIB_OBJECTS)
	@echo "Creating shared library $(SHARED_LIB)..."
	$(CC) -shared -fPIC -o $@ $^
	@echo "âœ… Shared library created: $(SHARED_LIB)"

# Object file compilation
libvisualmem.o: libvisualmem.c libvisualmem.h
	@echo "Compiling library source..."
	$(CC) $(CFLAGS) -fPIC -c $< -o $@

# Test program
$(TEST_TARGET): $(TEST_SOURCES) $(STATIC_LIB)
	@echo "Building test program..."
	$(CC) $(CFLAGS) -o $@ $< $(STATIC_LIB)
	@echo "âœ… Test program built: $(TEST_TARGET)"

# Example programs
$(EXAMPLE_TARGET): $(EXAMPLE_SOURCES) $(STATIC_LIB)
	@echo "Building example program..."
	$(CC) $(CFLAGS) -o $@ $< $(STATIC_LIB)
	@echo "âœ… Example program built: $(EXAMPLE_TARGET)"

# Run tests
test: $(TEST_TARGET)
	@echo "=== Running LibVisualMem Test Suite ==="
	./$(TEST_TARGET)

# Run examples
examples: $(EXAMPLE_TARGET)
	@echo "=== Running LibVisualMem Usage Examples ==="
	./$(EXAMPLE_TARGET)

# Complete validation (tests + examples)
validate: test examples
	@echo ""
	@echo "ðŸŽ‰ LIBVISUALMEM COMPLETE VALIDATION SUCCESSFUL! ðŸŽ‰"
	@echo ""
	@echo "All components tested and validated:"
	@echo "âœ… Static library (.a)"
	@echo "âœ… Shared library (.so)"
	@echo "âœ… Test suite (100% pass rate)"
	@echo "âœ… Usage examples (all scenarios)"
	@echo ""
	@echo "Library is ready for production use."

# Clean build artifacts
clean:
	@echo "Cleaning build artifacts..."
	rm -f $(LIB_OBJECTS)
	rm -f $(STATIC_LIB) $(SHARED_LIB)
	rm -f $(TEST_TARGET) $(EXAMPLE_TARGET)
	@echo "âœ… Clean complete"

# Show library information
info:
	@echo "LibVisualMem Library Information:"
	@echo "================================="
	@echo "Version: $(VERSION)"
	@echo "Static library: $(STATIC_LIB)"
	@echo "Shared library: $(SHARED_LIB)"
	@echo "Headers: $(LIB_HEADERS)"
	@echo "Test program: $(TEST_TARGET)"
	@echo "Example program: $(EXAMPLE_TARGET)"

.PHONY: all test examples validate clean info
