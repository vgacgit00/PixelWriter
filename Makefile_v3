# Makefile pour LibVisualMem v3.0
# =================================
# Compilation de la version 3.0 avec syst√®me de versioning automatique

CC = gcc
CFLAGS = -Wall -Wextra -O2 -std=c99 -D_GNU_SOURCE
LDFLAGS = -lX11 -lm -lpthread

# Fichiers sources
SOURCES = test_validation_complete_v3.c hardware_interface_v3.c
TARGET = test_validation_v3

# Biblioth√®ques
LIBRARIES = libvisualmem_v2.a

# R√®gles de compilation
all: $(TARGET)

$(TARGET): $(SOURCES) $(LIBRARIES)
	$(CC) $(CFLAGS) -o $@ $(SOURCES) $(LIBRARIES) $(LDFLAGS)

# Compilation de la biblioth√®que si n√©cessaire
libvisualmem_v2.a: libvisualmem_v2.c libvisualmem_v2.h
	$(CC) $(CFLAGS) -c libvisualmem_v2.c -o libvisualmem_v2.o
	ar rcs libvisualmem_v2.a libvisualmem_v2.o

# Nettoyage
clean:
	rm -f $(TARGET) *.o *.a
	rm -rf validation_v3_*

# Installation des d√©pendances (Ubuntu/Debian)
install-deps:
	sudo apt-get update
	sudo apt-get install -y libx11-dev libgl1-mesa-dev libjson-c-dev

# Installation des d√©pendances (CentOS/RHEL)
install-deps-rhel:
	sudo yum install -y libX11-devel mesa-libGL-devel json-c-devel

# Test rapide
test: $(TARGET)
	./$(TARGET)

# Test avec nettoyage automatique
test-clean: clean all test

# Validation compl√®te
validate: $(TARGET)
	@echo "üöÄ D√©marrage de la validation compl√®te v3.0..."
	@echo "üìÅ Cr√©ation automatique du r√©pertoire de version..."
	./$(TARGET)
	@echo "‚úÖ Validation termin√©e. Consultez le r√©pertoire de version cr√©√©."

# Aide
help:
	@echo "Makefile LibVisualMem v3.0"
	@echo "=========================="
	@echo ""
	@echo "Commandes disponibles:"
	@echo "  make all          - Compile le test de validation v3.0"
	@echo "  make test         - Lance le test de validation"
	@echo "  make validate     - Lance la validation compl√®te avec versioning"
	@echo "  make clean        - Nettoie les fichiers compil√©s"
	@echo "  make install-deps - Installe les d√©pendances (Ubuntu/Debian)"
	@echo "  make help         - Affiche cette aide"
	@echo ""
	@echo "Fonctionnalit√©s v3.0:"
	@echo "  ‚úÖ Syst√®me de versioning automatique"
	@echo "  ‚úÖ Benchmarks complets sans omission"
	@echo "  ‚úÖ Validation automatique √† chaque cr√©ation"
	@echo "  ‚úÖ Rapports d√©taill√©s en Markdown"
	@echo "  ‚úÖ M√©triques JSON structur√©es"

.PHONY: all clean test validate install-deps install-deps-rhel test-clean help